steps:


### Build
  - id: 'build'
    name: 'gcr.io/cloud_builders/docker'
    dir: 'microservices/backend'
    entrypoint: 'bash'
    env: ['VERSION=${BRANCH_NAME}-${SHORT_SHA}']
    args: ["docker", "build", "-t", "gcr.io/$PROJECT_ID/cloud_build/${BRANCH_NAME}/backend:${VERSION}", "."]


### Test


### Publish
  - id: 'publish'
    name: 'gcr.io/cloud-builders/docker'
    entrypoint: 'bash'
    env: ['VERSION=${BRANCH_NAME}-${SHORT_SHA}']
    args: ["docker", "push", "gcr.io/$PROJECT_ID/cloud_build/${BRANCH_NAME}/backend:${VERSION}"]


### Deploy