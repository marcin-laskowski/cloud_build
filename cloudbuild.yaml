steps:

### Build
  - id: 'build'
    name: 'gcr.io/cloud_builders/docker'
    dir: 'microservices/backend'
    entrypoint: 'bash' 
    args: 
      - '-c'
      - |
          [[ "$BRANCH_NAME" ]] && VERSION=${BRANCH_NAME}-${SHORT_SHA}
          if [[ ${BRANCH_NAME} == "master" ]] ; then
            docker build -t gcr.io/$PROJECT_ID/cloud_build/master/backend:$${VERSION} .
          elif [[ ${BRANCH_NAME} == "dev" ]] ; then
            docker build -t gcr.io/$PROJECT_ID/cloud_build/dev/backend:$${VERSION} .
          else ; then
            docker build -t gcr.io/$PROJECT_ID/cloud_build/test/backend:$${VERSION} .
          fi

### Test


### Publish
  - id: 'publish'
    name: 'gcr.io/cloud-builders/docker'
    dir: 'microservices/backend'
    entrypoint: 'bash'
    args: 
      - '-c'
      - |
          [[ "$BRANCH_NAME" ]] && VERSION=${BRANCH_NAME}-${SHORT_SHA}
          if [[ ${BRANCH_NAME} == "master" ]] ; then
            docker push gcr.io/$PROJECT_ID/cloud_build/master/backend:$${VERSION}
          elif [[ ${BRANCH_NAME} == "dev" ]] ; then
            docker push gcr.io/$PROJECT_ID/cloud_build/dev/backend:$${VERSION}
          else ; then
            docker push gcr.io/$PROJECT_ID/cloud_build/test/backend:$${VERSION}
          fi

### Deploy
